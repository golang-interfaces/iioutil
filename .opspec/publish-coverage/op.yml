description: publishes code coverage
name: publish-coverage
inputs:
  gitBranch:
    string:
      constraints: { minLength: 1 }
      description: git branch the coverage should be associated with
      default: master
  srcDir:
    dir:
      default: .
      description: directory containing the projects source code
run:
  container:
    cmd:
      - sh
      - -ce
      - |
        echo "publishing coverage"
        curl -s https://codecov.io/bash | bash -s
    dirs:
      /workDir: srcDir
    envVars:
      CODECOV_TOKEN: 471b867d-7e8a-48f3-9043-10c3bc45bdc7
      GIT_BRANCH: $(gitBranch)
    image: { ref: 'golang:1.8' }
    workDir: /workDir
